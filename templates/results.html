{% extends 'base.html' %} {% block body %}

<div class="container">
    {% if VoteList.length==0 %}
        <center>
            <h2 style="padding:10px;">No Elections Closed!!</h2>
        </center>
        <center style="padding:10px;font-size:20px;">Sample Results!!</center>
        <canvas id="myChart" width="975px" height="532px"></canvas>
    {% else %}
        {% if Listing %}
        <left>
            <h3>Select Election</h3>
        </left>
        <select class="custom-select" id="inputGroupSelect01" name="party_name" required>
            <option selected>{{ Election.ElectionName }}</option>
            {% for election in VoteList %}
                {% if  election.ElectionName!=Election.ElectionName %}
                    <option value="{{ election.ElectionName }}">{{ election.ElectionName }}</option>
                {% endif %}
            {% endfor %}
        </select>
            {% if Election.IsOpen %}
                <h2>Election Still in Progress!!</h2> 
                <br>
                <center style="padding:10px;font-size:20px;">Wait For Results!!</center>
            {% else %}
                {% if Listing|length !=0 %}
                    <h2>Election Closed!!</h2>
                    <center style="padding:10px;font-size:20px;">Here are the Results!!</center>
                    <canvas id="myChart" width="975px" height="532px"></canvas>
                {% else %}
                    <h2>Election Closed!!</h2>
                    <center style="padding:10px;font-size:20px;">No Votes Casted !!</center>
                {% endif %}
            {% endif %}
        {% else %}
            <left>
                <h3>Select Election</h3>
            </left>
            <select class="custom-select" id="inputGroupSelect01" name="party_name" required>
                <option value="" selected>choose..</option>
                {% for election in VoteList %}
                    {% if  election.ElectionName!=Election.ElectionName %}
                    <option value="{{ election.ElectionName }}">{{ election.ElectionName }}</option>
                    {% endif %}
                {% endfor %}
            </select>
            <center><h2>Choose An Election!!</h2></center>
        {% endif %}
    {% endif %}
</div>

<script>
    if(document.getElementById("inputGroupSelect01")){
        var select=document.getElementById("inputGroupSelect01")
        select.addEventListener("change",(event)=>{
        if (event.target.value != ''){
            var url ='/results/'+ event.target.value ;
            window.location = url; // redirect
        }
        })
    }

    
    if(document.getElementById('myChart')){
        var ctx =document.getElementById('myChart')
        var myChart = new Chart(ctx,
        {
            type: 'doughnut',
            data: {
            labels: 
            {% if PartyNames %}
                [
                {% for party in PartyNames %}
                    '{{party}}',
                {% endfor %}
                ]
            {% else %}
                ['BJP', 'Congress', 'JDU', 'CPM', 'AAP', 'Shiv Sena']
            {% endif %},
            indexLabel: "{labels} {y}",
            datasets: [{
            label: '# of Votes',
            data:
            {% if PartyNames %}
                [
                {% for party in PartyNames %}
                        {{Listing[party]}},
                {% endfor %}
                ]
            {% else %}
                [12,15,14,11,10,8]
            {% endif %},
            backgroundColor: [
                'rgba(255, 99, 132, 0.5)',
                'rgba(54, 162, 235, 0.5)',
                'rgba(255, 206, 86, 0.5)',
                'rgba(75, 192, 192, 0.5)',
                'rgba(153, 102, 255, 0.5)',
                'rgba(255, 159, 64, 0.5)'
            ],
            borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
            ],
            borderWidth: 1
        }]
        },
        });
    }
    
</script>
{% endblock%}